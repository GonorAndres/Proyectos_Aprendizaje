---
title: "250222_SeriesdTyAdS_Tarea1"
author: "Andrés González Ortega"
date: "2025-02-22"
output:
  pdf_document: default
  html_document: default
theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tseries)
library(forecast)
```

## Analisis de la temperatura diaria en la ciudad de Delhi durante 2013-2017.
En este documento se analizará como una serie de observaciones diarias en la ciudad de Delhi, en India, han ido variando a lo largo del tiempo por 4 años, tenemos dos grupos de datos los de entrenamiento, que son 1462 observaciones, y los de prueba, que son 114 observaciones. Estos dos grupos no fueron separados por mí, sino que en la base de datos que encontré estaban así separados, y después de investigar un poco entendí la idea de validación para predicción con el grupo numeroso construimos nuestro modelo de arima y usamos nuestra datos de prueba(o entrenamiento) para verificar nuestro modelo, es decir si las predicciones son acertadas, que es el objetivo principal de nuestro análisis quizá para destinar recursos energetícos por el uso de aire acondicionado o para detectar los cambios de temperatura más bruscos y alertar a la población sobre ellos.
  
La base de datos que seleccione fue extraída de la pagina [Kaggle](https://www.kaggle.com/datasets/sumanthvrao/daily-climate-time-series-data?resource=download) y aunque tenía información diversa como la velocidad del viento, la presión media o la humedad; decidí tomar la temperatura media por la naturaleza de las observaciones ya que la estacionalidad es un aspecto importante en estos primeros pasos del análisis de las series de tiempo, y por experiencia propia sé que las temperaturas tienen un ciclo de acuerdo a los estaciones y me pareció intuitivo que tuvieran una estacionalidad clara. La base de datos no tiene valores nulos y a partir de esto empecé a trabajar.

```{r datos, echo=FALSE}
# Load the data
data <- read.csv("C:/Users/andre/OneDrive/Documentos/Actuaria/Semestre_2025_2/Modelos de Supervivencia y Series de Tiempo/Tareas/Tarea1/archive/DailyDelhiClimateTrain.csv")$meantemp

test_data <- read.csv("C:/Users/andre/OneDrive/Documentos/Actuaria/Semestre_2025_2/Modelos de Supervivencia y Series de Tiempo/Tareas/Tarea1/archive/DailyDelhiClimateTest.csv")$meantemp

# Create a sequence of dates from 2013 to 2017
dates <- seq.Date(from = as.Date("2013-01-01"), to = as.Date("2017-01-01"), by = "day")
dates2 <- seq.Date(from = as.Date("2017-01-01"), to = as.Date("2017-04-24"), by = "day")


# Combine dates with your data
data_frame <- data.frame(date = dates, value = data)
data_frame2 <- data.frame(date = dates2, value = test_data)

# Convert to time series object
ts_data <- ts(data_frame$value, start = c(2013, 1), frequency = 365)
ts_data_test <- ts(data_frame2$value, start = c(2017, 1), frequency = 365) 
# Plot the time series
plot(ts_data, main = "Temperatura media diaria", ylab = "C°", xlab = "Tiempo")

```

Vemos la estacionalidad esperada por cada año y para entender mejor nuestra serie descomponemos en las partes esenciales para su estudio y lo graficamos.

```{r echo=FALSE}
# Decompose the time series
decomposed <- stl(ts_data, s.window = "periodic")

plot(decomposed)

# Check for stationarity
adf_test <- adf.test(ts_data)
print(adf_test)
```

Vemos la estacionalidad es ciclica que corresponde a una periodicidad anual de las estaciones, en particular las temperaturas son más bajas al final del año, es decir en invierno. Otra observación importante es la tendecia que va en aumento en los últimos dos años, quizá podríamos hablar de un aumento muy sútil en la temperatura; lo mismo que señalan algunos expertos sobre el cambio clímatico. También encontramos el factor aleatorio de la serie.

Ahora presetamos las gráficas de autocorrelación y autocorrelación parcial. Es decir los ACF y PACF.

```{r echo=FALSE}
ggAcf(ts_data, lag.max = 60)
```


```{r echo=FALSE}
ggPacf(ts_data, lag.max = 20)
  
```

Vemos que para la autocorrelación el diagrama presenta un Tails-off y para la autocorrelación parcial es claro un Cuts-off por lo que podemos tomar un modelo AR como el óptimo. Ahora lo que correspode a la estacionalidad esta no pasa la prueba por lo que tendremos que recurrir a una transformación para que la serie sea estacionaria primero realiçé la transformación de logaritmo y la prueba también dio que no era estacionaria al tomar la transformación diff() está me arrojo que la serie ya es estacionaria por lo que tome esta transformación para modelar con un AR y ya que el corte está en el primer lag tomaré un AR(1).

Usaré la serie transformada para comparar con las observaciones de prueba también transformada y vemos que las predicciónes entran en el rango de las observaciones por tanto nuestro modelo, con los datos después de la transformación, es útil para hacer predicciones que es el objetivo principal en el análisis de las series de tiempo.

```{r echo=FALSE}
# Step 1: Transform the Time Series (e.g., first-order differencing)
diff_data <- diff(ts_data)

adf_test2 <- adf.test(diff_data)
print(adf_test2)

#pasos para transformación inversa de diff
valor_inicial <- ts_data[1]

# Step 2: Fit the AR Model (e.g., AR(1) model)
ar_model <- arima(diff_data, order = c(1, 0, 0))

summary(ar_model)

# Step 4: Forecast Using the Model
forecasts <- forecast(ar_model, h = 114)  # Forecasting the next 30 days
plot(forecasts, main = "Observaciones bajo AR usando diff y los datos de prueba")

# Add the actual test data to the plot (if available)
# Assuming test_data is defined and contains the actual values for the forecast period
lines(diff(ts_data_test), col = "red", lwd = 2)

# Add a legend
legend("topleft", legend = c("Rango de predicción", "Datos Entrenamiento"), col = c("blue", "red"), lty = 1, lwd = 2)
```

```{r Ajustar un modelo ARIMA}
fit <- auto.arima(ts_data, seasonal = TRUE)
summary(fit)
```

```{r Análisis de Residuales}
checkresiduals(fit)

```

```{r}
h <- length(ts_data_test)  # Forecast horizon equal to the length of the test data
forecasts <- forecast(fit, h = h)

# Plot the forecasts
plot(forecasts, main = "Predicción vs Observado")
lines(ts_data_test, col = "red", lwd = 2)
legend("topright", legend = c("Predicción", "Observado"), col = c("blue", "red"), lty = 1, lwd = 2)

```
```{r}
print(accuracy(forecasts, ts_data_test))
```

